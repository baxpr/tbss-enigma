---
procyamlversion: 3.0.0-dev.0

containers:
containers:
  - name: tbss
    path: tbss-enigma_v2.1.0.sif
    source: docker://baxterprogers/tbss-enigma:v2.1.0

requirements:
  walltime: 0-1
  ppn: 1
  memory: 8G
jobtemplate: job_template_v3.txt

inputs:
  xnat:
    assessors:
      - name: tbss
        proctypes: tbss-enigma_v2
        resources:
          - {resource: MNI, ftype: DIR}

outputs:
  - {path: extracted_roi_means.csv, type: FILE, resource: STATS}
  - {path: tbss-enigma/stats-fix, type: FILE, resource: SCRIPTS}

command:
  type: singularity_exec
  container: tbss
  args: >-
    bash -c '
      cd /OUTPUTS &&
      wget -O tbss-enigma.tar.gz https://github.com/baxpr/tbss-enigma/archive/refs/tags/v3.0.0.tar.gz &&
      tar -zxf tbss-enigma.tar.gz &&
      mv tbss-enigma-* tbss-enigma &&
      export PATH=/OUTPUTS/tbss-enigma/stats-fix:\$PATH &&

      tbss-stats.sh --img_dir /INPUTS/MNI/MNI      
    '
